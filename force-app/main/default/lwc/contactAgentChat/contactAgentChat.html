<template>
  <lightning-card title={agentName} icon-name="standard:bot">
    <div class="container">
      <template if:true={errorMessage}>
        <div class="error">
          <lightning-icon icon-name="utility:warning" size="x-small"></lightning-icon>
          <span>{errorMessage}</span>
        </div>
      </template>

      <div class="context">
        <span class="label">Contact:</span>
        <span class="value">{contactName}</span>
        <span class="sep">•</span>
        <span class="label">Email:</span>
        <span class="value">{contactEmail}</span>
        <span class="sep">•</span>
        <span class="label">Lang:</span>
        <span class="value">{contactPreferredLang}</span>
      </div>

      <div class="transcript" role="log" aria-live="polite">
        <template for:each={formattedMessages} for:item="m">
          <div key={m.id} class={m.rowClass}>
            <div class={m.bubbleClass}>
              <div class="text">{m.text}</div>
              <div class="meta">{m.time}</div>
            </div>
          </div>
        </template>
      </div>

      <template if:true={isLoading}>
        <div class="loading">
          <lightning-spinner size="small"></lightning-spinner>
        </div>
      </template>

      <div class="inputRow">
        <lightning-textarea
          label="Message"
          variant="label-hidden"
          placeholder="Mesaj yaz… (örn: What's this contact's email? /summary /update-lang tr)"
          value={inputText}
          onchange={handleInputChange}
        ></lightning-textarea>

        <lightning-button
          variant="brand"
          label="Send"
          onclick={handleSend}
          disabled={isSendDisabled}
        ></lightning-button>
      </div>
    </div>
  </lightning-card>
</template>
